@model IEnumerable<vercom.Interfaces.iFlujoResumen>
@{
    ViewBag.Title = "RESUMEN FLUJO-E";
    var i = 0;
    double? saldoTotal = 0;
    double? entradaTotal = 0;
    double? salidaTotal = 0;
}
<div class="row wrapper border-bottom white-bg page-heading">
    <div class="col-lg-10">
        <h2>FLUJO DE EFECTIVO</h2>
        <ol class="breadcrumb">
            <li class="breadcrumb-item">
                <a href="@Url.Action("Index", "Home")">Inicio</a>
            </li>
            <li class="breadcrumb-item">
                <a>Flujo de efectivo</a>
            </li>
            <li class="active breadcrumb-item">
                <strong>Resumen</strong>
            </li>
        </ol>
    </div>
</div>
<div class="wrapper wrapper-content animated fadeInRight">
    <div class="row">
        <div class="col-lg-12">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <h5>
                        Resumen - Flujo de efectivo
                        <small class="m-l-sm">@DateTime.Today.Day/@DateTime.Now.Month/@DateTime.Now.Year</small>
                    </h5>
                    <div class="ibox-tools">
                        <a class="collapse-link">
                            <i class="fa fa-chevron-up"></i>
                        </a>
                        <a class="fullscreen-link">
                            <i class="fa fa-expand"></i>
                        </a>
                        <a class="close-link">
                            <i class="fa fa-times"></i>
                        </a>
                    </div>
                </div>
                <div class="ibox-content">
                    <div class="row" id="ajaxLoader" style="display: none">
                        <div class="sk-spinner sk-spinner-cube-grid">
                            <div class="sk-cube"></div>
                            <div class="sk-cube"></div>
                            <div class="sk-cube"></div>
                            <div class="sk-cube"></div>
                            <div class="sk-cube"></div>
                            <div class="sk-cube"></div>
                            <div class="sk-cube"></div>
                            <div class="sk-cube"></div>
                            <div class="sk-cube"></div>
                        </div>
                    </div>
                    <form role="form" class="form-inline">
                        <div class="form-group" id="data_1" style="width:25%">
                            <label style="margin-right:10px">FECHA</label>
                            <div class="input-group date">
                                <span class="input-group-addon"><i class="fa fa-calendar"></i></span><input type="text" name="fecha" id="fecha" class="form-control" placeholder="FECHA" value="@DateTime.Now.ToString("d")" required>
                            </div>
                        </div>
                        <div class="form-group" style="width:40%">
                            <label style="margin-right:10px">DESGLOSE - ÁREA</label>
                            <select class="form-control" name="areaid" id="areaid" style="width:75%" required="">
                                <option value="0">seleccione el área...</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <button class="btn btn-outline-success" id="filterFlujo" type="button">FILTRAR</button>
                        </div>
                    </form>
                    <hr class="hr-line-dashed" />
                    <div style="width: 100%; padding-left: -0px; ">
                        <div class="table-responsive">
                            <div id="renderTable"></div>
                            <div id="resumenTableDay">
                                <table class="table table-striped table-hover dt-responsive display nowrap DataTable" width="100%">
                                    <thead>
                                        <tr style="text-align:right">
                                            <th>AREA</th>
                                            <th>ENTRADA</th>
                                            <th>SALIDA</th>
                                            <th>SALDO</th>
                                        </tr>
                                    </thead>
                                    <tbody style="">
                                        @foreach (var item in Model)
                                        {

                                            i++;
                                            saldoTotal += item.saldo;
                                            var saldo = String.Format("{0:#,##0.00}", item.saldo);
                                            <tr>
                                                <td style="text-align:right">
                                                    @Html.DisplayFor(modelItem => item.area)
                                                </td>
                                                <td class="text-navy" style="text-align:right">
                                                    @if (item.entrada != null)
                                                    {
                                                        <i class="fa fa-level-up"> @item.entrada</i><br />
                                                        entradaTotal += item.entrada;
                                                    }
                                                </td>
                                                <td class="text-warning" style="text-align:right">
                                                    @if (item.salida != null)
                                                    {
                                                        <i class="fa fa-level-down"> @item.salida</i><br />
                                                        salidaTotal += item.salida;
                                                    }
                                                </td>
                                                <td class="cm-strong" style="text-align:right">
                                                    <strong>@saldo</strong>
                                                </td>
                                            </tr>
                                        }
                                        @{
                                            var CVentradaTotal = String.Format("{0:#,##0.00}", entradaTotal);
                                            var CVsalidaTotal = String.Format("{0:#,##0.00}", salidaTotal);
                                            var CVsaldoTotal = String.Format("{0:#,##0.00}", saldoTotal);
                                        }
                                        <tr id="resumenTotal" style="text-align:right;">
                                            <td></td>
                                            <td>TOTAL ENTRADA:<strong> @CVentradaTotal</strong></td>
                                            <td>TOTAL SALIDA:<strong> @CVsalidaTotal</strong></td>
                                            <td>SALDO DISPONIBLE:<strong> @CVsaldoTotal</strong></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
@section Styles {
    @Styles.Render("~/plugins/dataPickerStyles")
    @Styles.Render("~/Content/plugins/dataTables/dataTablesStyles")
    @Styles.Render("~/Content/plugins/chosen/chosenStyles")
    <style>
        div.dataTables_wrapper div.dataTables_filter input {
            width: 500px;
        }

        table.dataTable thead {                       
        }

        .page-link {
            color: black !important;
        }

        table {
            width: 100%;
        }

        th, td {
            padding: 8px;
            color: black;
            text-align: right;
        }

        th {
            color: black;
        }
    </style>
}

@section Scripts {
    @Scripts.Render("~/plugins/dataPicker")
    @Scripts.Render("~/plugins/dataTables")
    @Scripts.Render("~/plugins/chosen")
    <script src="@Url.Content("~/Scripts/decimal.js")"></script>
    <script>
        $(document).ready(function () {
            var fechaa = document.getElementById("fecha").value;
            $(".DataTable").DataTable({
                dom: '<"html5buttons"B>lTfgitp',
                order: [[0, "desc"]],
                buttons: {
                    dom: {
                        button: {
                            className: 'btn'
                        }
                    },
                    buttons: [
                        {
                            //definimos estilos del boton de excel
                            extend: "excel",
                            text: 'EXPORTAR A EXEL',
                            title: 'FLUJO DE EFECTIVO:' + fechaa,
                            className: 'btn btn-success',

                            // 1 - ejemplo básico - uso de templates pre-definidos
                            //definimos los parametros al exportar a excel

                            excelStyles: {
                                //template: "header_blue",  // Apply the 'header_blue' template part (white font on a blue background in the header/footer)
                                //template:"green_medium"

                                "template": [
                                    "blue_medium",
                                    "header_green",
                                    "title_medium"
                                ],

                            },

                            pageStyle: {
                                sheetPr: {
                                    pageSetUpPr: {
                                        fitToPage: 1            // Fit the printing to the page
                                    }
                                },
                                printOptions: {
                                    horizontalCentered: true,
                                    verticalCentered: true,
                                },
                                pageSetup: {
                                    orientation: "landscape",   // Orientacion
                                    paperSize: "9",             // Tamaño del papel (1 = Legal, 9 = A4)
                                    fitToWidth: "1",            // Ajustar al ancho de la página
                                    fitToHeight: "0",           // Ajustar al alto de la página
                                },
                                pageMargins: {
                                    left: "0.2",
                                    right: "0.2",
                                    top: "0.4",
                                    bottom: "0.4",
                                    header: "0",
                                    footer: "0",
                                },
                                repeatHeading: true,    // Repeat the heading row at the top of each page
                                repeatCol: 'A:A',       // Repeat column A (for pages wider than a single printed page)
                            },
                            excelStyles: {
                                template: 'blue_gray_medium',    // Add a template style as well if you like
                            }
                        },
                        {
                            extend: 'print',
                            text: 'IMPRIMIR',
                            title: '',
                            orientation: 'landscape',
                            className: 'btn btn-info',
                            customize: function (win) {
                                $(win.document.body).css('font-size', '12pt').prepend('<h3>"FLUJO DE EFECTIVO: ' + fechaa + '</h3>');
                                $(win.document.body).find('table').addClass('compact').css('font-size', 'inherit');
                                $(win.document.body).find('table').addClass('compact').css('text-align', 'right');
                            }
                        }
                    ]
                }
                , language: {
                    info: "Mostrando _START_ de _TOTAL_ registros",
                    infoFiltered: '(filtrado de _MAX_ registros totales)',
                    search: "Buscar:",
                    paginate: {
                        first: "Primero",
                        last: "Último",
                        next: "Siguiente",
                        previous: "Anterior",
                    },
                }
            });
        });
    </script>
    <script type="text/javascript">
        $(document).ready(function () {

            $("#areaid").chosen();


            const fechaa = document.getElementById("fecha").value;
            const areaa = document.getElementById("areaid").value;

            $('#data_1 .input-group.date').on('change',
                function () {


                    var url = '@Url.Action("_listpresupuestosFecha", "Parcial")';
                    var fecha = document.getElementById("fecha").value;

                    $.getJSON(url,
                        { fecha: fecha },
                        function (data) {
                            $('#areaid').empty();
                            $("#areaid").append("<option value=" + 0 + ">seleccione el área...</option>");
                            $.each(data,
                                function (i, item) {
                                    $("#areaid").append("<option value=" + item.areaID + ">" + item.area + "</option>");
                                });

                            $("#areaid").trigger("chosen:updated");
                    });

            });
            $('#filterFlujo').on('click', function () {
                    $('.DataTable').DataTable().clear().destroy();
                    $('#resumenTableDay').hide();

                    var fecha = document.getElementById("fecha").value;
                    var area = document.getElementById("areaid").value;

                    if (fecha == null || fecha == "") {
                        return false;
                    }

                    $.ajax({
                     url: '@Url.Action("_listFilterFlujoResumen", "Flujo")',
                     type: 'GET',
                     data: { fecha: fecha, areaid: area },
                     success: function (data) {

                         $('#renderTable').html(data);
                         var myTable = $('.DataTable').DataTable({
                             pageLength: 100,
                             dom: '<"html5buttons"B>lTfgitp',
                             order: [[0, "desc"]],
                                   buttons: {
                dom: {
                    button: {
                        className: 'btn'
                    }
                },
                buttons: [
                    {
                        //definimos estilos del boton de excel
                        extend: "excel",
                        text: 'EXPORTAR A EXEL',
                        title: 'FLUJO DE EFECTIVO:' + fechaa,
                        className: 'btn btn-success',

                        // 1 - ejemplo básico - uso de templates pre-definidos
                        //definimos los parametros al exportar a excel

                        excelStyles: {
                            //template: "header_blue",  // Apply the 'header_blue' template part (white font on a blue background in the header/footer)
                            //template:"green_medium"

                            "template": [
                                "blue_medium",
                                "header_green",
                                "title_medium"
                            ],

                        },

                        pageStyle: {
                            sheetPr: {
                                pageSetUpPr: {
                                    fitToPage: 1            // Fit the printing to the page
                                }
                            },
                            printOptions: {
                                horizontalCentered: true,
                                verticalCentered: true,
                            },
                            pageSetup: {
                                orientation: "landscape",   // Orientacion
                                paperSize: "9",             // Tamaño del papel (1 = Legal, 9 = A4)
                                fitToWidth: "1",            // Ajustar al ancho de la página
                                fitToHeight: "0",           // Ajustar al alto de la página
                            },
                            pageMargins: {
                                left: "0.2",
                                right: "0.2",
                                top: "27",
                                bottom: "0.4",
                                header: "0",
                                footer: "0",
                            },
                            repeatHeading: true,    // Repeat the heading row at the top of each page
                            repeatCol: 'A:A',       // Repeat column A (for pages wider than a single printed page)
                        },
                        excelStyles: {
                            template: 'blue_gray_medium',    // Add a template style as well if you like
                        }
                    },
                    {
                        extend: 'print',
                        text: 'IMPRIMIR',
                        title: '',
                        exportOptions:
                        {
                            stripHtml: false,
                            orientation: 'landscape',
                        },
                        orientation: 'landscape',
                        className: 'btn btn-info',
                        customize: function (win) {
                            $(win.document.body).css('font-size', '12pt').prepend('<h3>FLUJO DE EFECTIVO: ' + fechaa + '</h3>');
                            $(win.document.body).find('table').addClass('compact').css('font-size', 'inherit');
                            $(win.document.body).find('table').addClass('compact').css('text-align', 'right');
                        }
                    }
                ]
            }
            , language: {
                info: "Mostrando _START_ de _TOTAL_ registros",
                infoFiltered: '(filtrado de _MAX_ registros totales)',
                search: "Buscar:",
                paginate: {
                    first: "Primero",
                    last: "Último",
                    next: "Siguiente",
                    previous: "Anterior",
                },
            }
                         });

                     }, error: function () {
                         alert('Error loading partial view');
                     }
                    });
            });

            });
    </script>
    <script type="text/javascript">
        $(document).ready(function () {

            $('#data_1 .input-group.date').datepicker({
                todayBtn: "linked",
                locale: 'es',
                keyboardNavigation: false,
                format: "dd/mm/yyyy",
                forceParse: false,
                calendarWeeks: true,
                autoclose: true
            });

        });
    </script>
}