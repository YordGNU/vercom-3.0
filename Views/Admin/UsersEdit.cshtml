@model vercom.Models.Users
@{
    ViewBag.Title = "User - " + Model.UserName;
    if ((Model.UserName != null) && (Model.UserName != ""))
    {
        ViewBag.Title = ViewBag.Title + " (" + Model.UserName + ")";
    }
}
<div class="row wrapper border-bottom white-bg page-heading">
    <div class="col-lg-10">
        <h2>PANEL DE ADMINISTRACÓN</h2>
        <ol class="breadcrumb">
            <li class="breadcrumb-item">
                <a href="@Url.Action("Index", "Home")">Inicio</a>
            </li>
            <li class="breadcrumb-item">
                <a href="@Url.Action("Index", "Admin")">Administrar</a>
            </li>
            <li class="active breadcrumb-item">
                <strong>Editar usuario</strong>
            </li>
        </ol>
    </div>
</div>
<div class="wrapper wrapper-content animated fadeInRight">
    <div class="row">
        <div class="col-lg-12">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <h5>Editar usuario <small class="m-l-sm">@Model.UserName</small></h5>
                    <div class="ibox-tools">
                        <a class="collapse-link">
                            <i class="fa fa-chevron-up"></i>
                        </a>
                        <a class="fullscreen-link">
                            <i class="fa fa-expand"></i>
                        </a>
                        <a class="close-link">
                            <i class="fa fa-times"></i>
                        </a>
                    </div>
                </div>
                <div class="ibox-content">
                    <div class="row" id="ajaxLoader" style="display: none">
                        <div class="sk-spinner sk-spinner-cube-grid">
                            <div class="sk-cube"></div>
                            <div class="sk-cube"></div>
                            <div class="sk-cube"></div>
                            <div class="sk-cube"></div>
                            <div class="sk-cube"></div>
                            <div class="sk-cube"></div>
                            <div class="sk-cube"></div>
                            <div class="sk-cube"></div>
                            <div class="sk-cube"></div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-4 b-r">
                            <form role="form" method="post" action="@Url.Action("UsersEdit", "Admin")">
                                @Html.AntiForgeryToken()
                                @Html.ValidationSummary()
                                <input name='UserId' id='UserId' type="hidden" value="@Model.UserID" />
                                @Html.Partial("_userDetailsEdit", Model)
                                <div>
                                    <button class="btn btn-sm btn-outline-success float-right m-t-n-xs" type="submit"><strong>ACTUALIZAR</strong></button>
                                </div>
                            </form>
                        </div>
                        <div class="col-sm-8">
                            <div class="panel" id="RolesTable">
                                @Html.Partial("_ListUserRoleTable", Model)
                            </div>
                            @Html.Partial("_ListEditableUserRoleTable")
                            <br />
                            <div class="btn-group">
                                <a href="@Url.Action("RoleIndex")" class="btn btn-outline-danger float-left m-t-n-xs"><i class="fa fa-plus-square"></i> IR A ROLES</a>
                                <a href="@Url.Action("Index")" class="btn btn-outline-info float-left  m-t-n-xs"><i class="fa fa-user"></i> IR A USUARIOS</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
@section Styles {
    @Styles.Render("~/Content/plugins/dataTables/dataTablesStyles")
    @Styles.Render("~/plugins/sweetAlertStyles")
}

@section Scripts {
    @Scripts.Render("~/plugins/dataTables")
    @Scripts.Render("~/plugins/sweetAlert")
    <script>
    $(document).ready(function () {
             $('#AddRole').on('click',
                 function () {
                     const _userId = document.getElementById("UserID").value;
                     const _id = document.getElementById("RoleId").value;
                     var _parameters = { userId: _userId, id: _id };
                     $.ajax({
                         url: '@Url.Action("AddUserRoleReturnPartialView", "Admin")',
                         type: "GET",
                         data: _parameters,
                         success: function (data, textStatus, jqXHR) {
                             $('#userRoleTable').html(data);                          
                         }
                     });
                 });
             });
    </script>
    <script>
        $(document).ready(function () {
            $(document).on("click", ".deleteButton", function () {
                var _userId = window.location.pathname.substring(window.location.pathname.lastIndexOf("/") + 1);
                var _id = $(this).data('id');
                swal({
                    title: "Estas seguro?",
                    text: "Esta acción es irrebercible!",
                    type: "warning",
                    showCancelButton: true,
                    confirmButtonColor: "#DD6B55",
                    confirmButtonText: "Si, eliminar!",
                    cancelButtonText: "No, cancelar!",
                    closeOnConfirm: true,
                },
                    function (isConfirm) {
                        if (isConfirm) {
                            $.ajax({
                                url: '@Url.Action("DeleteUserFromRole", "Admin")',
                                type: "GET",
                                data: { roleId: _id, userId: _userId },
                                success: function (response) {
                                    if (response.success) {
                                        $('#row_' + _id).remove();
                                    } else {
                                        return false;
                                    }
                                },
                                error: function (xhr, status, error) {
                                }
                            });
                        }
                    });
            });
        });
    </script>
    <script type="text/javascript">
        $(document).ready(function () {
            $('#userRoleTable').DataTable({
                pageLength: 25,
                dom: '<"html5buttons"B>lTfgitp',
                buttons: [

                ], language: {
                    info: "Mostrando _START_ de _TOTAL_ registros",
                    infoFiltered: '(filtrado de _MAX_ registros totales)',
                    search: "Buscar:",
                    paginate: {
                        first: "Primero",
                        last: "Último",
                        next: "Siguiente",
                        previous: "Anterior",
                    },
                }

            });
        });
        $(document).ajaxStart(function () { $('#ajaxLoader').show(); });
        $(document).ajaxComplete(function () {
            $('#ajaxLoader').hide();
        });
    </script>
}

